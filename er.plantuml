@startuml ERDiagram
' Skin parameters for better visualization
' skinparam linetype ortho
skinparam class {
    BackgroundColor White
    ArrowColor Black
    BorderColor Black
}

' Entities
entity "User" {
    + user_id : Integer <<PK>>
    --
    email : String
    password : String
    phone : String
    name : String
    is_verified : Boolean
}

entity "EmailVerification" <<Weak Entity>> {
    + user_id : Integer <<FK, PK>>
    + verification_token : String <<PK>>
    --
    expiration_date : Date
    created_date : Date
}

entity "Member" {
    + member_id : Integer <<PK>>
    --
    user_id : Integer <<FK>>
    membership_start_date : Date
    membership_end_date : Date
    current_loan_count : Integer
    can_borrow : Boolean
    member_type : String
}

entity "Loan" {
    + loan_id : Integer <<PK>>
    --
    member_id : Integer <<FK>>
    book_id : Integer <<FK>>
    loan_date : Date
    due_date : Date
    return_date : Date <<nullable>>
    fine : Integer
}

entity "Reminder" <<Weak Entity>> {
    + loan_id : Integer <<FK, PK>>
    + reminder_date : Date <<PK>>
    --
    is_sent : Boolean
    next_reminder_date : Date <<nullable>>
}

entity "Book" {
    + book_id : Integer <<PK>>
    --
    title : String
    isbn : String
    year : Integer
    publisher_id : Integer <<FK>>
}

entity "Publisher" {
    + publisher_id : Integer <<PK>>
    --
    name : String
    address : String
    contact : String
}

entity "Author" {
    + author_id : Integer <<PK>>
    --
    name : String
    biography : String
}

entity "BookAuthor" <<Weak Entity>> {
    + book_id : Integer <<FK, PK>>
    + author_id : Integer <<FK, PK>>
}

entity "BookCount" <<Weak Entity>> {
    + title : String <<PK>>
    + author_id : Integer <<FK, PK>>
    --
    total_books : Integer
    available_books : Integer
}

' Identifying relationships (total participation for weak entities) with cardinalities
User ||--|| EmailVerification : "has email verification"
Loan ||--|| Reminder : "triggers reminder"
Book ||--|| BookAuthor : "written by"
Author ||--|| BookAuthor : "associates with author"
Book ||--|| BookCount : "counts books"
Author ||--|| BookCount : "counts books by author"

' Non-identifying relationships with cardinalities
User ||--|| Member : "has membership"
Member ||--o{ Loan : "borrows"
Book ||--o{ Loan : "is loaned out"
Publisher ||--o{ Book : "is published by"

@enduml
